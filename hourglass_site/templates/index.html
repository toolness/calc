{% extends "base.html" %}
{% load staticfiles %}

{% block head %}
<link rel="stylesheet" href="{% static 'hourglass_site/style/index.css' %}">
<script src="{% static 'hourglass_site/js/vendor/rgbcolor.js' %}"></script>
<script src="{% static 'hourglass_site/js/vendor/StackBlur.js' %}"></script>
<script src="{% static 'hourglass_site/js/vendor/canvg.js' %}"></script>
<script src="{% static 'hourglass_site/js/vendor/canvas-toBlob.js' %}"></script>
<script src="{% static 'hourglass_site/js/vendor/FileSaver.js' %}"></script>

<!--[if IE 9]>
  <script src="{% static 'hourglass_site/js/vendor/vex.combined.min.js' %}"></script>
  <script>vex.defaultOptions.className = 'vex-theme-default';</script>
  <link rel="stylesheet" href="{% static 'hourglass_site/style/vendor/vex.css' %}" />
  <link rel="stylesheet" href="{% static 'hourglass_site/style/vendor/vex-theme-default.css' %}" />
<![endif]-->

{% endblock %}

{% block body %}
<form id="search" class="search" role="form">
  <input type="hidden" name="sort" value="current_price">
  <input type="hidden" name="exclude" value="">

  <section class="search">
    <div class="container">
      <div class="row">
        <div class="six columns">
          <input id="labor_category" name="q" placeholder="Type a labor category" class="search u-full-width" type="text">
          <label for="labor_category" style="display:none;">Type a labor category</label>
          <div id="query-types">
            <label><input type="radio" name="query_type" value="match_all" checked> Contains words</label>
            <label><input type="radio" name="query_type" value="match_phrase"> Contains phrase</label>
            <label><input type="radio" name="query_type" value="match_exact"> Exact match</label>
          </div>
        </div>
        <div class="six columns">
          <button id="submit-button" class="submit button-primary">Search</button>
          <input id="reset-button" class="reset button" type="reset" value="Clear search">
        </div>
      </div><!-- /.row -->
    </div><!-- /.container -->
  </section><!-- /.search -->

  <section class="results">
    <div class="container">
      <div class="row">

        <div class="filter-container columns three">

          <div class="filter-block">

            <h5 class="filter-title">Optional Filters</h5>

            <label>Education level:</label>

            <dl class="dropdown">

              <dt>
                <a href="">
                  <span class="eduSelect">Select <span class='sr-only'>to reveal Education Level options</span></span>
                  <div class="multiSel"></div>
                </a>
              </dt>

              <dd>
                <div class="multiSelect">
                  <fieldset>
                    <legend class="sr-only">Education level:</legend>
                    <ul>
                      <li>
                        <input id="high-school" type="checkbox" value="HS" name="education" />
                        <label for="high-school">High School</label>
                      </li>
                      <li>
                          <input id="associates" type="checkbox" value="AA" name="education" />
                          <label for="associates">Associates</label>
                      </li>
                      <li>
                          <input id="bachelors-degree" type="checkbox" value="BA" name="education" />
                          <label for="bachelors-degree">Bachelors Degree</label>
                      </li>
                      <li>
                          <input id="masters-degree" type="checkbox" value="MA" name="education" />
                          <label for="masters-degree">Masters Degree</label>
                      </li>
                      <li>
                          <input id="phd" type="checkbox" value="PHD" name="education" />
                          <label for="phd">Ph.D</label>
                      </li>
                    </ul>
                  <fieldset>
                </div>
              </dd>
            </dl>

            <div class="filter">
              <fieldset>
                <legend>
                  <label for="experience_range">Experience:</label>
                </legend>

                <div class="slider"></div>

                <div class="experience_range">

                  <label for="min_experience" class="sr-only">Minimum Years</label>
                  <select id="min_experience" name="min_experience">
                    <option selected value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                    <option value="32">32</option>
                    <option value="33">33</option>
                    <option value="34">34</option>
                    <option value="35">35</option>
                    <option value="36">36</option>
                    <option value="37">37</option>
                    <option value="38">38</option>
                    <option value="39">39</option>
                    <option value="40">40</option>
                    <option value="41">41</option>
                    <option value="42">42</option>
                    <option value="43">43</option>
                    <option value="44">44</option>
                    <option value="45">45</option>
                  </select>
                  -
                  <label for="max_experience" class="sr-only">Maximum Years</label>
                  <select id="max_experience" name="max_experience">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                    <option value="32">32</option>
                    <option value="33">33</option>
                    <option value="34">34</option>
                    <option value="35">35</option>
                    <option value="36">36</option>
                    <option value="37">37</option>
                    <option value="38">38</option>
                    <option value="39">39</option>
                    <option value="40">40</option>
                    <option value="41">41</option>
                    <option value="42">42</option>
                    <option value="43">43</option>
                    <option value="44">44</option>
                    <option selected value="45">45</option>
                  </select>

                  years

                </div>

              </fieldset>

            </div>

            <div class="filter">
              <label for="site">Worksite:</label>
              <select id="site" name="site">
                <option value="">(all)</option>
                <option>customer</option>
                <option>contractor</option>
                <option>both</option>
              </select>
            </div>

            <div class="filter">
              <label for="business_size">Business size:</label>
              <select id="business_size" name="business_size">
                <option value="">(all)</option>
                <option value="s" data-label="small">small business</option>
                <option value="o">other than small</option>
              </select>
            </div>

            <div class="filter">
              <label for="schedule">Schedule:</label>
              <a href="/about#schedules" class="schedule-info">What's this?</a>
              <select id="schedule" name="schedule">
                <option value="">(all)</option>
                <option value="AIMS">AIMS</option>
                <option value="Consolidated">Consolidated</option>
                <option value="Environmental">Environmental</option>
                <option value="Logistics">Logistics</option>
                <option value="Language Services">Language Services</option>
                <option value="MOBIS">MOBIS</option>
                <option value="PES">PES</option>
              </select>
            </div>

            <div class="filter contract-year">
              <label for="contract_year">Contract Year:</label>

              <ul>
                <li>
                  <label for="current-year" class="radio">
                    <input id="current-year" type="radio" checked name="year" value="current" tabindex="0">
                    <span tabindex="-1" class="checkbox-focus"></span>0
                  </label>
                </li>
                <li>
                  <label for="one-year-out" class="radio">
                    <input id="one-year-out" type="radio" name="year" value="1" tabindex="0">
                    <span tabindex="-1" class="checkbox-focus"></span>1
                  </label>
                </li>
                <li>
                  <label for="two-years-out" class="radio">
                    <input id="size-large" type="radio" name="year" value="2" tabindex="0">
                    <span tabindex="-1" class="checkbox-focus"></span>2
                  </label>
                </li>
              </ul>              
            </div>

            <!--
            <div class="filter">
              <label for="fiscal_year">Fiscal Year:</label>
              <select id="fiscal_year" name="fiscal_year">
              </select>
            </div>
            -->
          </div>

        </div>

        <div class="graph-block columns nine">
          <canvas id="graph" class="hidden" width="710" height="280"></canvas> <!-- for converting the histogram into an img -->
          <p id="description" class="">
            Showing <span data-key="count">0</span> of
            <span id="results-count" class="total" data-key="total">0</span>
            <span data-key="results">results</span>
            <span class="filters">
              <span class="not-empty">with</span>
            </span>
          </p>

          <h4>Hourly Rate Data</h4>

          <div class="proposed-price">
            <input type="number" step="0.01" name="proposed-price" placeholder="Proposed price" class="two-decimal-places" />
            <button class="button-primary go" />Go</button>
          </div>

          <div class="loading-indicator">
            <p class="message">Loading results...</p>
            <div class="error-message"></div>
          </div>

          <div class="graph">


            <svg id="price-histogram" class="graph histogram has-data" aria-description="A histogram showing the distribution of labor category prices. Each bar represents a range within that distribution">
              <style>
                /* styles here for download graph compatibility */

                * {
                  vector-effect: non-scaling-stroke;
                }

                .stddev-rect {
                  position: absolute;;
                }

                .bars .bar rect {
                  fill: #17779f;
                }

                .range-fill {
                  fill: #eeeeee;
                }

                .range-rule {
                  stroke: #757575;
                  fill: none;
                  stroke-dasharray: 5,5;
                  stroke-width: 1;
                }

                .label-rule {
                  stroke: #757575;
                }

                .stddev-text {
                  fill: #757575;
                }

                .axis .label {
                  fill: #757575;
                  font-style: italic;
                }

                .axis line,
                .axis path {
                  fill: none;
                  stroke-width: 1;
                  stroke: #000;
                  shape-rendering: crispEdges;
                }

                .axis text {
                  font-size: 13px;
                }

                .stddev-text-label {
                  font-size: 12px;
                  fill: #757575;
                }

                .avg .value, .pp .value,
                .axis .tick.primary text {
                  font-weight: bold;
                  -webkit-font-smoothing: antialiased;
                }

                .average, .proposed {
                  fill: #fff;
                }

                rect {
                  fill: #999;
                  stroke: #fff;
                  stroke-width: 1;
                  shape-rendering: crispEdges;
                }

                .avg-label-box, .pp-label-box {
                  fill: #000;
                  stroke: none;
                }

                .avg line, .pp line {
                  stroke-width: 1;
                  stroke: #000;
                }
              </style>

            </svg>
          </div>

          <div class="highlights-container row">

            <div class="price-block eight columns">

              <div class="row">

                <div class="standard-deviation-block">
                  <h5 class="standard-deviation-title">Std Deviation -1</h5>
                  <h5 id="standard-deviation-minus-highlight" class="sd-highlight"></h5>
                </div>

                <div class="avg-price-block">
                  <h5 class="avg-price-title">Average</h5>
                  <h5 id="avg-price-highlight"></h5>
                </div>

                <div class="standard-deviation-block">
                  <h5 class="standard-deviation-title">Std Deviation +1</h5>
                  <h5 id="standard-deviation-plus-highlight" class="sd-highlight"></h5>
                </div>

              </div>

            </div>

            <div class="proposed-price-block">
              <h5 class="proposed-price-title">Proposed Price</h5>
              <h5 class="proposed-price-highlight"></h5>
            </div>

          </div>


          <div class="download-buttons row">
            <div class="four columns">
              <a id="download-histogram" class="button button-primary" href="#">⬇ Download graph</a>
            </div>

          <div id="results-actions four columns">
            <a id="export-data" class="button button-primary"
              title="Click to export your search results to an Excel file (CSV)" href="{{ API_HOST }}rates/csv/">⬇ Export Data (CSV)</a>
          </div>

          <p class="rates-help-text">The rates shown here are fully burdened, applicable worldwide, and representative of the current fiscal year. This data represents rates awarded at the master contract level.</p>

        </div><!-- /.div -->

      </div><!-- /.row -->

      <div class="table-container">
        <table id="results-table" class="results has-data">
          <thead>
            <tr>
              <th scope="col" class="exclude" data-key="exclude" data-format=""><a id="restore-excluded" class="restore merge-params" href="?exclude="></a></th>
              <th scope="col" class="sortable tooltip" data-key="labor_category">Labor Category</th>
              <th scope="col" class="sortable tooltip" data-key="education_level" title="Minimum years of education">Min&nbsp;Edu.</th>
              <th scope="col" class="sortable tooltip" data-key="min_years_experience" title="Minimum years of experience">Experience</th>
              <th scope="col" class="sortable tooltip" data-key="current_price" title="Ceiling price" data-format="$%,.02f">Price</th>
              <th scope="col" data-key="idv_piid">Contract #</th>
              <th scope="col" class="sortable tooltip" data-key="vendor_name">Vendor</th>
              <th scope="col" class="sortable collapsible tooltip" data-key="schedule">Schedule</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="8">
                <a href="#results-table">Return to the top</a>
              </td>
          </tfoot>
        </table>
      </div>

    </div><!-- /.container -->
  </section><!-- /.results -->

</form>

<![if gt IE 8]>
<script src="{% static 'hourglass_site/js/vendor/jquery.auto-complete.min.js' %}"></script>
<script src="{% static 'hourglass_site/js/index.js' %}"></script>
<![endif]>

{% endblock %}
